{% extends 'core/base.html' %}
{% block content %}

{% include 'gp_admin/subpages/_menu.html' %}

<div class="container max-width-container">

  <div class="row bg-light-gray">
    <div class="col-md-2">
      <h2 class="text-center-middle text-center">Graduate <br /> Supervision</h2>
    </div>
    <div class="col-md-8">
      {% include 'gp_admin/subpages/_search_fields.html' with path='grad_supervision' %}
    </div>
    <div class="col-md-2"></div>
  </div>

  {% include 'core/subpages/_searched_message.html' with items=professors total_items=total_professors %}

  {% for prof in professors %}

    <div class="row mb-5">

      <div class="col-md-3">

        <div class="bg-prompt">
          <div class="prompt p-4 mb-4">
            <h5 class="text-dark-blue mb-3">{{ prof.get_full_name }}</h5>
            <p class="font-italic">{{ prof.profile.position.name }}</p>

            <div>
              <p class="d-inline">
                Number of students:
                <span class="text-chocolate font-weight-bold">{{ prof.graduate_supervision_set.count }}</span>
              </p>
              <a class="float-right" href="{% url 'gp_admin:add_grad_supervision' username=prof.username %}?next={{ request.get_full_path }}">Add Student</a>
            </div>

            <hr />

            <div>
              <div class="d-inline">
                {% for pg in prof.profile.programs.all %}
                  <span class="h7">{{ pg.code }}</span>{% if not forloop.last %},{% endif %}
                {% empty %}
                  None
                {% endfor %}
              </div>
              <div class="float-right">
                {% for role in prof.profile.roles.all %}
                  {% include 'core/subpages/_role.html' with data=role.name %}
                {% empty %}
                  None
                {% endfor %}
              </div>
            </div>
          </div>
        </div>

      </div>
      <div class="col-md-9">

        {{ prof.is_grad_advisor }}

        <table
          class="table table-striped table-hover table-bordered table-responsive-md text-center fs-sm"
          data-toggle="table"
          data-sortable="true"
          data-classes=""
        >
          <thead>
            <tr>
              <th>GSID</th>
              <th>Professor Role</th>
              <th data-sortable="true">Student <br /> First Name</th>
              <th data-sortable="true">Student <br /> Last Name</th>
              <th>Studnet Number</th>
              <th>Email</th>
              <th data-sortable="true">Status</th>
              <th>Additional <br /> Info</th>
            </tr>
          </thead>
          <tbody>
            {% for gs in prof.graduate_supervision_set.all %}
              <tr>
                <td>{{ gs.id }}</td>
                <td>{{ gs.professor_role }}</td>
                <td>{{ gs.student.first_name }}</td>
                <td>{{ gs.student.last_name }}</td>
                <td>{{ gs.student.student_number }}</td>
                <td>{{ gs.student.email }}</td>
                <td>{{ gs.student.status.name }}</td>
                <td>{% include 'gp_admin/subpages/_modal_additional_info.html' with data=gs.student %}</td>
              </tr>
            {% empty %}
              <tr>
                <td>No students found</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

  {% empty %}

    <div>No professors found</div>

  {% endfor %}

  {% include 'gp_admin/subpages/_table_paginator.html' with data=professors %}

</div>

{% endblock %}
