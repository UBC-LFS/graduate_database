{% extends 'core/base.html' %}
{% block content %}

{% include 'gp_admin/subpages/_menu.html' %}

<div class="container max-width-container">

  <div class="row bg-light-gray">
    <div class="col-md-2">
      <h2 class="text-center-middle text-center">Students</h2>
    </div>
    <div class="col-md-8">
      {% include 'gp_admin/subpages/_search_fields.html' with path='students' %}
    </div>
    <div class="col-md-2">
      <div class="bg-light-gray p-4">
        <a class="btn btn-primary" href="{% url 'gp_admin:add_student' %}">Add Student</a>
      </div>
    </div>
  </div>

  {% include 'core/subpages/_searched_message.html' with items=students total_items=total_students %}

  <table
    class="table table-striped table-hover table-bordered table-responsive-md text-center table-vertical-middle fs-xs"
    data-toggle="table"
    data-sortable="true"
    data-classes=""
  >
    <thead>
      <tr>
        <th>#</th>
        <th data-sortable="true">Last <br /> Name</th>
        <th data-sortable="true">First <br /> Name</th>
        <th>Student <br /> Number</th>
        <th>Email</th>
        <th>Additional <br /> Info</th>
        <th>Current <br /> Degree <br /> Info</th>
        <th>Previous <br /> Degree <br /> Info</th>
        <th>Confidential <br /> Info</th>
        <th>LOA <br /> (Months)</th>
        <th>LOA <br /> Details</th>
        <th>Policy 85</th>
        <th>Note</th>
        <th data-sortable="true">Supervisors</th>
        <th data-sortable="true">Created on</th>
        <th data-sortable="true">Updated on</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for stud in students %}
        <tr>
          <td>{{ stud.id }}</td>
          <td>
            {{ stud.last_name }}
            {% if stud.sis_details %}
              <br />
              {% include 'gp_admin/subpages/_modal_sis_details.html' with data=stud %}
            {% endif %}
          </td>
          <td>{{ stud.first_name }}</td>
          <td>{{ stud.student_number }}</td>
          <td>{{ stud.email }}</td>
          <td>{% include 'gp_admin/subpages/_modal_additional_info.html' with data=stud %}</td>
          <td>{% include 'gp_admin/subpages/_modal_curr_degree_info.html' with data=stud %}</td>
          <td>{% include 'gp_admin/subpages/_modal_prev_degree_info.html' with data=stud %}</td>
          <td>{% include 'gp_admin/subpages/_modal_confidential_info.html' with data=stud %}</td>
          <td>{{ stud.loa_months }}</td>
          <td>{% include 'gp_admin/subpages/_modal_loa_details.html' with data=stud %}</td>
          <td>
            {% if stud.policy_85 %}
              {% include 'gp_admin/subpages/_check_success.html' %}
            {% endif %}
          </td>
          <td>
            {% if stud.note %}
              {% include 'gp_admin/subpages/_modal_note.html' with data=stud %}
            {% endif %}
          </td>
          <td>

            <span class="d-none">{{ stud.graduate_supervision_set.count }}</span>
            {% if stud.graduate_supervision_set.count > 0 %}

              <button class="btn btn-xs btn-info" type="button" data-toggle="modal" data-target="#supervisors-modal-{{ stud.id }}">
                {{ stud.graduate_supervision_set.count }}
              </button>

              <div class="modal fade" id="supervisors-modal-{{ stud.id }}" tabindex="-1" role="dialog" aria-labelledby="supervisors-modal-label-{{ stud.id }}" aria-hidden="true">
                <div class="modal-dialog modal-lg" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title text-info" id="supervisors-modal-label-{{ stud.id }}">Supervisors</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    </div>
                    <div class="modal-body text-left">

                      <h6 class="mb-4">
                        Student Full Name: <span class="text-dark-blue font-weight-bold">{{ stud.get_full_name }}</span>
                      </h6>

                      <table class="modal-table table">
                        <thead>
                          <tr>
                            <th>#</th>
                            <th>Professor</th>
                            <th>Professor Role</th>
                            <th>Created on</th>
                            <th>Updated on</th>
                          </tr>
                        </thead>
                        <tbody>
                          {% for gs in stud.graduate_supervision_set.all %}
                          <tr>
                            <td>{{ gs.id }}</td>
                            <td>{{ gs.professor.get_full_name }}</td>
                            <td>{{ gs.professor_role.name }}</td>
                            <td>{{ gs.created_on }}</td>
                            <td>{{ gs.updated_on }}</td>
                          </tr>
                          {% endfor %}
                        </tbody>
                      </table>

                    </div>
                  </div>
                </div>
              </div>

            {% else %}

              {{ stud.graduate_supervision_set.count }}

            {% endif %}

          </td>
          <td>
            <span class="d-none">{{ app.created_on|date:"Y m d z" }}</span>
            {{ stud.created_on }}
          </td>
          <td>
            <span class="d-none">{{ app.updated_on|date:"Y m d z" }}</span>
            {{ stud.updated_on }}
          </td>
          <td>
            <button class="btn btn-warning btn-xs fs-xs mb-2" type="button" name="button">Edit</button> <br />
            <button class="btn btn-danger btn-xs fs-xs" type="button" name="button">Delete</button>
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="16">No graduate students found</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  {% include 'gp_admin/subpages/_table_paginator.html' with data=students %}

</div>

{% endblock %}
