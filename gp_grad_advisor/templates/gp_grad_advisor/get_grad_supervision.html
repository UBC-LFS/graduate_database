{% extends 'core/base.html' %}
{% block content %}

{% include 'gp_grad_advisor/_menu.html' %}

<div class="container max-width-container">

  <div class="bg-light-gray mb-4 p-3">
    <h2 class="">Graduate Supervision</h2>
  </div>

  <div class="row mb-5">

    <div class="col-md-3">

      <div class="bg-prompt">
        <div class="prompt p-4 mb-4">
          <h5 class="text-dark-blue mb-3">
            {% if prof.profile.title %}
              {{ prof.profile.title }}
            {% endif %}
            {{ prof.get_full_name }}
          </h5>
          <p class="font-italic mb-2">{{ prof.profile.position.name }}</p>

          <ul class="list-left-20">
            {% if prof.is_grad_advisor %}
              <li>
                Number of professors:
                <span class="text-chocolate font-weight-bold">{{ prof.colleages.count }}</span>
              </li>
            {% endif %}
            <li>
              Number of students:
              <span class="text-chocolate font-weight-bold">{{ prof.graduate_supervision_set.count }}</span>
            </li>
          </ul>

          <hr />

          <div class="d-flex justify-content-between align-items-center">
            <div>
              {% for pg in prof.profile.programs.all %}
                <div class="h7">{{ pg.code }}</div>
              {% empty %}
                <div class="h7">No Programs</div>
              {% endfor %}
            </div>
            <div>
              {% for role in prof.profile.roles.all %}
                {% include 'core/subpages/_role.html' with data=role.name %}
              {% empty %}
                <div class="h7">No Roles</div>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>

      <div class="left-aside-btn-groups">
        <a class="btn btn-outline-primary" href="{{ info.href }}">Go to Home</a>
      </div>

    </div>

    <div class="col-md-9">

      {% if prof.is_grad_advisor %}

        <section class="mb-5">
          <h5 class="text-dark-blue mb-2">
            Professors <span class="text-secondary">({{ prof.colleages.count }})</span>
          </h5>

          <table
            class="table table-striped table-hover table-bordered table-responsive-md text-center fs-sm"
            data-toggle="table"
            data-sortable="true"
            data-classes=""
            data-pagination="true"
            data-search="true"
            data-page-size="10"
            data-page-list="[25, 50, 100, all]"
          >
            <thead>
              <tr>
                <th>UID</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Title</th>
                <th>Position</th>
                <th>Program <br /> Code</th>
                <th>Contact <br /> Info</th>
                <th>Graduate <br /> Supervision</th>
              </tr>
            </thead>
            <tbody>
              {% for coll in prof.colleages %}
                <tr>
                  <td>{{ coll.id }}</td>
                  <td data-sortable="true">{{ coll.first_name }}</td>
                  <td data-sortable="true">{{ coll.last_name }}</td>
                  <td>{{ coll.profile.title.name }}</td>
                  <td>{{ coll.profile.position.name }}</td>
                  <td>
                    {% for pg in coll.profile.programs.all %}
                      <div>{{ pg.code }}</div>
                    {% empty%}
                      None
                    {% endfor %}
                  </td>
                  <td>
                    <button class="btn btn-xs btn-link fs-sm" type="button" data-toggle="modal" data-target="#contact-info-modal-{{ coll.id }}">
                      View
                    </button>

                    <div class="modal fade" id="contact-info-modal-{{ coll.id }}" tabindex="-1" role="dialog" aria-labelledby="contact-info-modal-label-{{ coll.id }}" aria-hidden="true">
                      <div class="modal-dialog" role="document">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title text-info" id="contact-info-modal-label-{{ coll.id }}">Contact Information</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                          </div>
                          <div class="modal-body text-left">

                            <div class="modal-item">
                              <div>
                                <h6>Phone:</h6>
                                <span>{{ coll.profile.phone }}</span>
                              </div>
                              <div>
                                <h6>Fax:</h6>
                                <span>{{ coll.profile.fax }}</span>
                              </div>
                              <div>
                                <h6>Office:</h6>
                                <span>{{ coll.profile.office }}</span>
                              </div>
                            </div>

                          </div>
                        </div>
                      </div>
                    </div>
                  </td>
                  <td>
                    <span class="d-none">{{ coll.graduate_supervision_set.count }}</span>
                    {% if coll.graduate_supervision_set.count > 0 %}

                      <button class="btn btn-xs btn-info" type="button" data-toggle="modal" data-target="#grad-supervision-modal-{{ coll.id }}">
                        {{ coll.graduate_supervision_set.count }}
                      </button>

                      <div class="modal fade" id="grad-supervision-modal-{{ coll.id }}" tabindex="-1" role="dialog" aria-labelledby="grad-supervision-modal-label-{{ coll.id }}" aria-hidden="true">
                        <div class="modal-dialog modal-lg" role="document">
                          <div class="modal-content">
                            <div class="modal-header">
                              <h5 class="modal-title text-info" id="grad-supervision-modal-label-{{ coll.id }}">Graduate Supervision</h5>
                              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            </div>
                            <div class="modal-body text-left">

                              <h6 class="mb-4">
                                Professor Full Name:
                                <a class="d-inline" href="{% url 'gp_admin:get_grad_supervision' %}?first_name={{ coll.first_name }}&last_name={{ coll.last_name }}">{{ coll.get_full_name }}</a>
                              </h6>

                              <table class="modal-table table">
                                <thead>
                                  <tr>
                                    <th>GSID</th>
                                    <th>Professor Role</th>
                                    <th>Student</th>
                                    <th>Created on</th>
                                    <th>Updated on</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  {% for gs in coll.graduate_supervision_set.all %}
                                  <tr>
                                    <td>{{ gs.id }}</td>
                                    <td>{{ gs.professor_role.name }}</td>
                                    <td>{{ gs.student.get_full_name }}</td>
                                    <td>{{ gs.created_on }}</td>
                                    <td>{{ gs.updated_on }}</td>
                                  </tr>
                                  {% endfor %}
                                </tbody>
                              </table>

                            </div>
                          </div>
                        </div>
                      </div>

                    {% else %}

                      {{ coll.graduate_supervision_set.count }}

                    {% endif %}
                  </td>
                </tr>
              {% empty %}
                <tr>
                  <td>No professors found.</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </section>

      {% endif %}

      <section>
        <h5 class="text-dark-blue mb-2">
          Students <span class="text-secondary">({{  prof.graduate_supervision_set.count }})</span>
        </h5>
        <table
          class="table table-striped table-hover table-bordered table-responsive-md text-center fs-sm"
          data-toggle="table"
          data-sortable="true"
          data-classes=""
          data-pagination="true"
          data-search="true"
          data-page-size="10"
          data-page-list="[25, 50, 100, all]"
        >
          <thead>
            <tr>
              <th>GSID</th>
              <th>Professor Role</th>
              <th data-sortable="true">First Name</th>
              <th data-sortable="true">Last Name</th>
              <th>Studnet <br /> Number</th>
              <th>Email</th>
              <th data-sortable="true">Status</th>
              <th>More <br /> Info</th>
            </tr>
          </thead>
          <tbody>
            {% for gs in prof.graduate_supervision_set.all %}
              <tr>
                <td>{{ gs.id }}</td>
                <td>{{ gs.professor_role }}</td>
                <td>{{ gs.student.first_name }}</td>
                <td>{{ gs.student.last_name }}</td>
                <td>{{ gs.student.student_number }}</td>
                <td>{{ gs.student.email }}</td>
                <td>{{ gs.student.status.name }}</td>
                <td>{% include 'gp_admin/subpages/_modal_additional_info.html' with data=gs.student %}</td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="8">No students found</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>  
      </section>

    </div>
  </div>

</div>


{% endblock %}
